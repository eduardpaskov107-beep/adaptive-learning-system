name: Daily Learning Analytics Report

on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9 —É—Ç—Ä–∞ –ø–æ –ú–æ—Å–∫–≤–µ (6:00 UTC)
    - cron: '0 6 * * *'
  workflow_dispatch:
    inputs:
      date:
        description: 'Report date (YYYY-MM-DD)'
        required: false
        default: 'today'
      format:
        description: 'Report format'
        required: true
        default: 'markdown'
        type: choice
        options:
          - markdown
          - json
          - html

jobs:
  generate-report:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install matplotlib pandas
    
    - name: Generate learning analytics report
      env:
        REPORT_DATE: ${{ github.event.inputs.date || 'today' }}
        REPORT_FORMAT: ${{ github.event.inputs.format }}
      run: |
        python scripts/generate_daily_report.py --date "$REPORT_DATE" --format "$REPORT_FORMAT"
    
    - name: Commit and push report
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add reports/
        git commit -m "üìä Daily learning analytics report for $(date +'%Y-%m-%d')" || echo "No changes to commit"
        git push origin HEAD:main
    
    - name: Upload report as artifact
      uses: actions/upload-artifact@v3
      with:
        name: learning-report-$(date +'%Y-%m-%d')
        path: reports/
